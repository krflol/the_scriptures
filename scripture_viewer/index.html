<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scripture Viewer</title>
    <style>
/* General Body & Layout */
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    margin: 0;
    background-color: #fdfdfd;
    color: #333;
}

.container {
    display: flex;
    height: 100vh;
}

.pane {
    padding: 1em;
    overflow-y: auto;
    border-left: 1px solid #eee;
}

/* Navigation Pane */
.navigation-pane {
    width: 25%;
    min-width: 250px;
    background-color: #f7f7f7;
    border-left: none;
}

#navigation-tree ul {
    list-style-type: none;
    padding-left: 1em;
}

#navigation-tree li {
    cursor: pointer;
    padding: 4px 0;
}

.nav-item {
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.nav-item:hover {
    background-color: #e0e0e0;
}

.nav-item.active {
    background-color: #d0d0d0;
    font-weight: bold;
}

/* Content Pane */
.content-pane {
    width: 50%;
    flex-grow: 1; /* Takes up remaining space */
    font-family: "Georgia", serif;
    font-size: 1.1em;
    line-height: 1.8;
}

#chapter-title {
    font-family: inherit;
    border-bottom: 2px solid #eee;
    padding-bottom: 0.5em;
    margin-top: 0;
}

.verse {
    margin-bottom: 1em;
}

.verse-number {
    font-weight: bold;
    font-size: 0.8em;
    vertical-align: super;
    margin-right: 0.5em;
    color: #888;
}

/* Search Pane */
.search-pane {
    width: 25%;
    min-width: 250px;
    background-color: #f7f7f7;
}

#search-input {
    width: calc(100% - 20px);
    padding: 10px;
    font-size: 1em;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-bottom: 1em;
}

.search-result-item {
    padding: 10px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
}

.search-result-item:hover {
    background-color: #e9e9e9;
}

.search-result-item .location {
    font-weight: bold;
    display: block;
    margin-bottom: 5px;
}

.search-result-item .text-snippet strong {
    background-color: #fff2a8;
}

</style>
</head>
<body>
    <div class="container">
        <div class="pane navigation-pane">
            <h2>Navigation</h2>
            <div id="navigation-tree"></div>
        </div>
        <div class="pane content-pane">
            <h1 id="chapter-title">Welcome</h1>
            <div id="chapter-content">
                <p>Select a chapter from the navigation menu to begin reading.</p>
            </div>
        </div>
        <div class="pane search-pane">
            <h2>Search</h2>
            <input type="text" id="search-input" placeholder="Search for keywords...">
            <div id="search-results"></div>
        </div>
    </div>

    <script>
    // Injected data from build.py
    const scriptureData = {
  "Kethubim - Writings": {},
  "Nebi'im - Prophets": {},
  "Torah -Teachings": {
    "Bereshith (Genesis)    בְּרֵאשִׁית": {
      "1": [
        {
          "verse": 1,
          "text": "In the beginning Elohim created the heavens and the earth.",
          "id": "v1"
        },
        {
          "verse": 2,
          "text": "And the earth came to be formless and empty, and darkness was on the face of the deep. And the Spirit of Elohim was moving on the face of the waters.",
          "id": "v2"
        },
        {
          "verse": 3,
          "text": "And Elohim said, \"Let light come to be,\" and light came to be.",
          "id": "v3"
        },
        {
          "verse": 4,
          "text": "And Elohim saw the light, that it was good. And Elohim separated the light from the darkness",
          "id": "v4"
        },
        {
          "verse": 5,
          "text": "And Elohim called the light 'day' and the darkness He called 'night'. And there came to be evening and there came to be morning, one day.",
          "id": "v5"
        },
        {
          "verse": 6,
          "text": "And Elohim said, Let an expanse come to be in the midst of the waters, and let it separate the waters from the waters.\"",
          "id": "v6"
        },
        {
          "verse": 7,
          "text": "And Elohim made the expanse, and separated the water which were under the expanse from the waters which were above the expanse. And it came to be so.",
          "id": "v7"
        },
        {
          "verse": 8,
          "text": "And Elohim called the expanse 'heavens.' And there came to be evening and there came to be morning, the second day.",
          "id": "v8"
        },
        {
          "verse": 9,
          "text": "And Elohim said, \"Let the waters under the heavens be gathered together into one place, and let the dry land appear.\" And it came to be so.",
          "id": "v9"
        },
        {
          "verse": 10,
          "text": "And Elohim called the dry land 'earth,' and the collection of the waters He called 'seas.' And Elohim saw that it was good.",
          "id": "v10"
        },
        {
          "verse": 11,
          "text": "And Elohim said, \"Let the earth bring forth grass, the planet that yields seed, and the fruit tree that yields fruit according to its kind, whose seed is in itself, on the earth.\" And it came to be so.",
          "id": "v11"
        },
        {
          "verse": 12,
          "text": "And the earth brought forth grass, the plant that yields seed according to its kind, and the tree that yields fruit, whose seed is in itself according to its kind. And Elohim saw that it was good.",
          "id": "v12"
        },
        {
          "verse": 13,
          "text": "And there came to be evening and there came to be morning, the third day.",
          "id": "v13"
        },
        {
          "verse": 14,
          "text": "And Elohim said, \"Let lights come to be in the expanse of the heavens to separate the day from the night, and let them be for signs and appointed times, and for days and years,",
          "id": "v14"
        },
        {
          "verse": 15,
          "text": "and let them be for lights in the expanse of the heavens to give light on the earth.\" And it came to be so",
          "id": "v15"
        },
        {
          "verse": 16,
          "text": "And Elohim made two great lights: the greater light to rule the day, and the lesser light to rule the night, and the stars.",
          "id": "v16"
        },
        {
          "verse": 17,
          "text": "And Elohim set them in the expanse of the heavens to give light on the earth,",
          "id": "v17"
        },
        {
          "verse": 18,
          "text": "and to rule over the day and over the night, and to separate the light from the darkness. And Elohim saw that it was good.",
          "id": "v18"
        },
        {
          "verse": 19,
          "text": "And there came to be evening and there came to be morning, the fourth day.",
          "id": "v19"
        },
        {
          "verse": 20,
          "text": "And Elohim said, \"Let the waters teem with shoals of living beings, and let birds fly above the earth on the face of the expanse of the heavens.\"",
          "id": "v20"
        },
        {
          "verse": 21,
          "text": "And Elohim created great sea creatures and every living being that moves, with which the waters teemed, according to their kind, and every winged bird according to its kind. And Elohim saw that it was good",
          "id": "v21"
        },
        {
          "verse": 22,
          "text": "And Elohim blessed them, saying, \"Be fruitful and increate, and fill the waters in the seas and let the birds increase on the earth.\"",
          "id": "v22"
        },
        {
          "verse": 23,
          "text": "And there came to be evening, and there came to be morning, the fifth day.",
          "id": "v23"
        },
        {
          "verse": 24,
          "text": "And Elohim said, \"Let the earth bring forth the living being according to its kind: livestock and creeping creatures and beasts of the earth, according to its kind.\" And it came to be so.",
          "id": "v24"
        },
        {
          "verse": 25,
          "text": "And Elohim made the beast of the earth according to its kind, livestock according to its kind, and all that creep on the earth according to its kind. And Elohim saw that it was good.",
          "id": "v25"
        },
        {
          "verse": 26,
          "text": "And Elohim said \"Let us make man in our image according to our likeness, and let them rule over the fish of the sea, and over the birds of the heavens, and over the livestock, and over all the earth, and over all the creeping creatures that creep on the ground.\"",
          "id": "v26"
        },
        {
          "verse": 27,
          "text": "An Elohim created the man in His image. In the image of Elohim, He created him - male and female, He created them.",
          "id": "v27"
        },
        {
          "verse": 28,
          "text": "And Elohim blessed them and said to them, \"Be fruitful and increase, and fill the earth and subdue it, and rule over the fish of the sea, and over the birds of the heavens, and over all creeping creatures on the earth.\"",
          "id": "v28"
        },
        {
          "verse": 29,
          "text": "And Elohim said, \"See, I have given you every plant that yields seed which is on the face of all the earth, and every tree who's fruit yields seed, to you it is for food.\"",
          "id": "v29"
        },
        {
          "verse": 30,
          "text": "\"And to every beast of the earth, and to every bird of the heavens, and to every creeping creature on the earth, in which there is a living being, every green plant is for food.\" And it came to be so",
          "id": "v30"
        },
        {
          "verse": 31,
          "text": "And Elohim saw all that He had made, and see, it was very good. And there came to be evening and there came to be morning on the sixth day.",
          "id": "c069a8"
        }
      ],
      "2": [
        {
          "verse": 1,
          "text": "Thus the heavens and the earth were completed, and all their array.",
          "id": "v1"
        },
        {
          "verse": 2,
          "text": "And in the seventh day Elohim completed His work which He had done, and He rested in the seventh day from all His work which He had made.",
          "id": "v2"
        },
        {
          "verse": 3,
          "text": "And Elohim blessed the seventh day and set it apart, because on it He rested from all Hish work which Elohim in creation had made.",
          "id": "v3"
        },
        {
          "verse": 4,
          "text": "These are the births of the heavens and the earth when they were created, in the day that    יהוה Elohim made earth and heaven.",
          "id": "v4"
        },
        {
          "verse": 4,
          "text": "Now no shrub of the field was yet on the earth, and no plant of the field had yet sprung up, for יהוה Elohim had not sent rain on the earth, and there was no man to till the ground.",
          "id": "v4"
        }
      ]
    }
  }
};

    // Injected script from script.js
// This script is now injected into index.html by build.py
// The `scriptureData` variable is globally available in the <script> tag.

document.addEventListener('DOMContentLoaded', () => {
    const navigationTree = document.getElementById('navigation-tree');
    const chapterTitle = document.getElementById('chapter-title');
    const chapterContent = document.getElementById('chapter-content');
    const searchInput = document.getElementById('search-input');
    const searchResults = document.getElementById('search-results');

    let flatData = [];

    // --- Data Initialization ---
    function initialize() {
        if (typeof scriptureData === 'undefined' || Object.keys(scriptureData).length === 0) {
            console.error("Scripture data is missing!");
            chapterContent.innerHTML = `<p>Error: Scripture data not found. Please re-run the build script: <code>python scripture_viewer/build.py</code></p>`;
            return;
        }
        flattenData();
        buildNavigation();
    }

    function flattenData() {
        for (const divName in scriptureData) {
            for (const bookName in scriptureData[divName]) {
                for (const chapterNum in scriptureData[divName][bookName]) {
                    const verses = scriptureData[divName][bookName][chapterNum];
                    if (Array.isArray(verses)) {
                        verses.forEach(verse => {
                            flatData.push({
                                division: divName,
                                book: bookName,
                                chapter: chapterNum,
                                ...verse
                            });
                        });
                    }
                }
            }
        }
    }

    // --- Navigation ---
    function buildNavigation() {
        const ul = document.createElement('ul');
        for (const divName in scriptureData) {
            const divLi = document.createElement('li');
            divLi.textContent = divName;
            const bookUl = document.createElement('ul');
            for (const bookName in scriptureData[divName]) {
                const bookLi = document.createElement('li');
                bookLi.textContent = bookName;
                const chapterUl = document.createElement('ul');
                for (const chapterNum in scriptureData[divName][bookName]) {
                    const chapterLi = document.createElement('li');
                    chapterLi.className = 'nav-item';
                    chapterLi.textContent = `Chapter ${chapterNum}`;
                    chapterLi.dataset.division = divName;
                    chapterLi.dataset.book = bookName;
                    chapterLi.dataset.chapter = chapterNum;
                    chapterLi.addEventListener('click', handleNavClick);
                    chapterUl.appendChild(chapterLi);
                }
                bookLi.appendChild(chapterUl);
                bookUl.appendChild(bookLi);
            }
            divLi.appendChild(bookUl);
            ul.appendChild(divLi);
        }
        navigationTree.appendChild(ul);
    }

    function handleNavClick(event) {
        const { division, book, chapter } = event.target.dataset;
        displayChapter(division, book, chapter);

        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
        event.target.classList.add('active');
    }

    // --- Content Display ---
    function displayChapter(division, book, chapter) {
        const verses = scriptureData[division]?.[book]?.[chapter];
        if (!verses) return;

        chapterTitle.textContent = `${book.replace(/\(.*?\)/g, '').trim()} - Chapter ${chapter}`;
        chapterContent.innerHTML = '';

        verses.forEach(verse => {
            const p = document.createElement('p');
            p.className = 'verse';
            p.id = verse.id;

            const span = document.createElement('span');
            span.className = 'verse-number';
            span.textContent = verse.verse;

            // Render the verse text as HTML
            const textNode = document.createElement('span');
            textNode.innerHTML = verse.text; // Use innerHTML to parse links

            p.appendChild(span);
            p.appendChild(textNode);
            chapterContent.appendChild(p);
        });
    }

    // --- Search ---
    function handleSearch() {
        const query = searchInput.value.toLowerCase();
        searchResults.innerHTML = '';

        if (query.length < 2) {
            return;
        }

        const results = flatData.filter(item => item.text.toLowerCase().includes(query));

        results.slice(0, 100).forEach(result => {
            const div = document.createElement('div');
            div.className = 'search-result-item';
            div.addEventListener('click', () => {
                displayChapter(result.division, result.book, result.chapter);
                setTimeout(() => {
                    const verseElement = document.getElementById(result.id);
                    if (verseElement) {
                        verseElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        verseElement.style.backgroundColor = '#fff2a8';
                        setTimeout(() => { verseElement.style.backgroundColor = '' }, 2000);
                    }
                }, 100);
            });

            const location = document.createElement('div');
            location.className = 'location';
            location.textContent = `${result.book.replace(/\(.*?\)/g, '').trim()} ${result.chapter}:${result.verse}`;

            const snippet = document.createElement('div');
            snippet.className = 'text-snippet';
            const highlightedText = result.text.replace(new RegExp(query, 'gi'), (match) => `<strong>${match}</strong>`);
            snippet.innerHTML = highlightedText;

            div.appendChild(location);
            div.appendChild(snippet);
            searchResults.appendChild(div);
        });
    }

    searchInput.addEventListener('input', handleSearch);

    // --- Initial Load ---
    initialize();
});

    </script>
</body>
</html>